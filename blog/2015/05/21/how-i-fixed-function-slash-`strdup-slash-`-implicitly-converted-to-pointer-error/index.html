
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Function strdup implicitly converted to pointer - {love to code}</title>
	<meta name="author" content="nkn">

	
	<meta name="description" content="Function Strdup Implicitly Converted to Pointer May 21st, 2015 I was trying to make a debian package for libvarnam. Lot of work went into making the &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="{love to code}" type="application/atom+xml">
	
	<link rel="canonical" href="http://navaneeth.github.io/blog/2015/05/21/how-i-fixed-function-slash-%60strdup-slash-%60-implicitly-converted-to-pointer-error/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	Included file 'custom/head.html' not found in _includes directory
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul></nav>
<!-- <nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/navaneethkn" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/navaneeth" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav> -->
<div class="profile-container">
  <div class="profilepic">
    <script src="/javascripts/md5.js"></script>
    <script type="text/javascript">
$(function(){
  $('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("navaneethkn@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
});
    </script>
  </div>
  <hgroup>
  <h1 class="site-title"><a href="/">{love to code}</a></h1>
  
  <p class="site-subtitle">Random thoughts on programming and travel.</p>
  
  </hgroup>
  
</div>
</header>
			</div>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="article-inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
	<h1 class="title" itemprop="name">Function Strdup Implicitly Converted to Pointer</h1>
  








  



  <div class="post-date"><time datetime="2015-05-21T10:50:48+05:30" data-updated="true" itemprop="datePublished">May 21<span>st</span>, 2015</time></div>
	<div class="entry-content" itemprop="articleBody"><p>I was trying to make a debian package for <a href="http://varnamproject.com">libvarnam</a>. Lot of work went into making the package ready. Debian has very strict rules about how the packaging should be done. Debian also marks few errors as fatal and which may require a code change to fix it. One of the errors I faced was the following:</p>

<blockquote><p>Our automated build log filter detected the problem(s) above that will
likely cause your package to segfault on architectures where the size of
a pointer is greater than the size of an integer, such as ia64 and amd64.</p>

<p>This is often due to a missing function prototype definition.</p>

<p>Since use of implicitly converted pointers is always fatal to the application
on ia64, they are errors. Please correct them for your next upload.</p>

<p>More information can be found at: <a href="http://wiki.debian.org/ImplicitPointerConversions">http://wiki.debian.org/ImplicitPointerConversions</a></p></blockquote>

<p>The above error failed the build.</p>

<p>The relevant code where the failure happened looks like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">char</span><span class="o">*</span>
</span><span class='line'><span class="nf">strbuf_get_last_unicode_char</span><span class="p">(</span><span class="n">strbuf</span> <span class="o">*</span><span class="n">word</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">varray</span> <span class="o">*</span><span class="n">characters</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">lastUnicodeChar</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="n">characters</span> <span class="o">=</span> <span class="n">strbuf_chars</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">varray_is_empty</span> <span class="p">(</span><span class="n">characters</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">varray_free</span> <span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">lastUnicodeChar</span> <span class="o">=</span> <span class="n">strdup</span> <span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">varray_get</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="n">varray_length</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span> <span class="cm">/* -&gt; Error here */</span>
</span><span class='line'>  <span class="n">varray_free</span><span class="p">(</span><span class="n">characters</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">free</span><span class="p">);</span>
</span><span class='line'>  <span class="cm">/*ending should be freed in the calling function*/</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">lastUnicodeChar</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>strdup</code> is not a ANSI C function, hence it is not portable and not available with all compilers. This has caused the function prototype to be not found. When a function prototype is missing, gcc by default return an integer value. De-referencing the returned pointer will cause a segfault.</p>

<p>To fix this, I found a portable <code>strdup</code> implementation in the OpenBSD source code. I have used that and disabled the default <code>strdup</code>.</p>
</div>
	<div class="meta"><span class="tags">


	<a class='category' href='/blog/categories/build/'>build</a>, <a class='category' href='/blog/categories/c/'>c</a>, <a class='category' href='/blog/categories/linux/'>linux</a>


</span></div>

</article>

	<div class="share">
	<div class="share_icon_group addthis_toolbox addthis_default_style addthis_32x32_style">
	
  <a class="share_icon addthis_button_preferred_1"></a>
	
	</div>
  <!--<script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid="></script>-->
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2015 - nkn -
  <span class="credit"><a href="http://octopress.org">Octopress</a></span>
</p>


<p>Theme: <a href="https://github.com/qingwang/octopress-theme-yinyang">YinYang</a></p>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'lovetocode';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://navaneeth.github.io/blog/2015/05/21/how-i-fixed-function-slash-%60strdup-slash-%60-implicitly-converted-to-pointer-error/';
        var disqus_url = 'http://navaneeth.github.io/blog/2015/05/21/how-i-fixed-function-slash-%60strdup-slash-%60-implicitly-converted-to-pointer-error/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-38544003-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



		</div>
	</div>
</body>
</html>
