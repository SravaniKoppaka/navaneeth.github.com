
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>{love to code}</title>
    <meta name="author" content="nkn">
    
	<meta name="description" content="Published on: Jul 28th, 2013 Tags: build,, cmake Recently in libvarnam, I had to build a static and shared library from the same source files. This &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="{love to code}" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-38544003-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        {love to code}
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/navaneeth" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/navaneethkn" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/about">About</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/07/28/building-static-and-shared-libraries-using-cmake/">
		
			Building Static and Shared Libraries Using CMake</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-07-28T19:46:00+05:30" pubdate data-updated="true">Jul 28<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/build/'>build,</a>, <a class='category' href='/blog/categories/cmake/'>cmake</a>


</div>
    </div>
		<p>Recently in <a href="https://github.com/navaneeth/libvarnam">libvarnam</a>, I had to build a static and shared library from the same source files. This was much harder before CMake 2.8. From CMake 2.8.8, CMake has support for <code>Object library</code> which made it very simple.</p>

<p>Basic idea is to use <code>add_library</code> with <code>OBJECT</code> type. CMake will compile all the source files provided in this target and makes the object files for it. It won&rsquo;t create a temporary static library with all these object files. These object files can later be referred in the target which builds the library. In my CMakeLists.txt, I have the following.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">add_library</span> <span class="p">(</span><span class="n">core</span> <span class="n">OBJECT</span> <span class="err">$</span><span class="p">{</span><span class="n">SOURCES</span><span class="p">})</span>
</span><span class='line'><span class="n">add_library</span> <span class="p">(</span><span class="k">static</span> <span class="n">STATIC</span> <span class="err">$</span><span class="o">&lt;</span><span class="n">TARGET_OBJECTS</span><span class="o">:</span><span class="n">core</span><span class="o">&gt;</span><span class="p">)</span>
</span><span class='line'><span class="n">add_library</span> <span class="p">(</span><span class="n">shared</span> <span class="n">SHARED</span> <span class="err">$</span><span class="o">&lt;</span><span class="n">TARGET_OBJECTS</span><span class="o">:</span><span class="n">core</span><span class="o">&gt;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above will build static and shared library from the same set of object files. This improves compilation time considerably as source files will be compiled only once and used in multiple targets.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/04/02/nodejs0-dot-10-dot-2-is-not-backward-compatible/">
		
			nodejs0.10.2 Is Not Backward Compatible</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-04-02T08:56:00+05:30" pubdate data-updated="true">Apr 2<span>nd</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/javascript/'>javascript,</a>, <a class='category' href='/blog/categories/nodejs/'>nodejs</a>


</div>
    </div>
		<p>I have a node module which failed to compile on node0.10.2. I have the following code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">uv_queue_work</span> <span class="p">(</span><span class="nx">uv_default_loop</span><span class="p">(),</span> <span class="o">&amp;</span><span class="nx">data</span><span class="o">-&gt;</span><span class="nx">request</span><span class="p">,</span> <span class="nx">perform_learn_async</span><span class="p">,</span> <span class="nx">after_learn</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>node-gyp build
</span></code></pre></td></tr></table></div></figure>


<p>will fail with error saying the 4th argument to <code>uv_queue_work</code> is incorrect. Node version 0.10.2 onwards, you have to explicitly cast the function reference to <code>uv_after_work_cb</code> to get it working. Something like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">uv_queue_work</span> <span class="p">(</span><span class="nx">uv_default_loop</span><span class="p">(),</span> <span class="o">&amp;</span><span class="nx">data</span><span class="o">-&gt;</span><span class="nx">request</span><span class="p">,</span> <span class="nx">perform_learn_async</span><span class="p">,</span> <span class="p">(</span><span class="nx">uv_after_work_cb</span><span class="p">)</span> <span class="nx">after_learn</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I also find nodejs version numbers are not very informative. They always increase the minor and patch version and not the major version. I&rsquo;d expect major version to be incremented if it has breaking changes.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/28/how-to-use-individual-lines-pulled-from-stdin-in-the-middle-of-a-command-when-using-xargs/">
		
			How to Use Individual Lines Pulled From Stdin in the Middle of a Command When Using Xargs</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-02-28T10:57:00+05:30" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/command-line/'>command-line</a>, <a class='category' href='/blog/categories/linux/'>linux,</a>


</div>
    </div>
		<p><code>xargs</code> is very powerful commandline utility. Here is what Wikipedia says about <code>xargs</code></p>

<blockquote><p>xargs is a command on Unix and most Unix-like operating systems used to build and execute command lines from standard input</p></blockquote>

<p>Most common use of <code>xargs</code> would be to do something like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>find . -type f -print0 | xargs -0 rm
</span></code></pre></td></tr></table></div></figure>


<p>Let us assume that you have a file with list of files to be downloaded from a website. Something like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>one.zip
</span><span class='line'>two.zip
</span><span class='line'>three.zip
</span></code></pre></td></tr></table></div></figure>


<p>With <code>wget</code> and <code>xargs</code> all these files can be downloaded easily with just one command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat filenames.txt | xargs -I filename wget http://download.com/filename
</span></code></pre></td></tr></table></div></figure>


<p><code>-I</code> flag takes a replacement string and <code>xargs</code> will then replace <code>filename</code> with the value obtained from <code>stdin</code>.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/20/how-to-upload-files-when-testing-using-selenium-webdriver/">
		
			How to Upload Files When Testing Using Selenium Webdriver</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-02-20T15:42:00+05:30" pubdate data-updated="true">Feb 20<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/automated-testing/'>automated-testing</a>, <a class='category' href='/blog/categories/java/'>java,</a>, <a class='category' href='/blog/categories/selenium/'>selenium,</a>, <a class='category' href='/blog/categories/testing/'>testing,</a>, <a class='category' href='/blog/categories/webdriver/'>webdriver,</a>


</div>
    </div>
		<p>You can use the following code to set a file path to the file upload control.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">WebElement</span> <span class="n">file</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">&quot;control_id&quot;</span><span class="o">));</span>
</span><span class='line'><span class="n">file</span><span class="o">.</span><span class="na">sendKeys</span><span class="o">(</span><span class="s">&quot;/full/path/to/file&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>You need to pass full path to the <code>sendKeys()</code> for it to work. Otherwise <code>sendKeys()</code> fails silently.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/19/is-thread-dot-sleep-evil/">
		
			Is Thread.Sleep() Evil?</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-02-19T09:54:00+05:30" pubdate data-updated="true">Feb 19<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/dot-net/'>.net</a>, <a class='category' href='/blog/categories/c-number/'>c#,</a>, <a class='category' href='/blog/categories/threading/'>threading,</a>


</div>
    </div>
		<p>If you search for this topic, you will find lots of information and many of them claiming <code>Thread.Sleep()</code> is evil. However, I think this evilness is mostly dependent on which context <code>Thread.Sleep()</code> is used.</p>

<p>You might have seen code like the below one.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">while</span> <span class="p">(!</span><span class="n">exit</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">DoWork</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">10000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code example does some work and sleeps for 1 minute before does the job again. This simple example has some potential issues.</p>

<p>Internally <code>Thread.Sleep()</code> calls WIN32&rsquo;s <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms686298%28v=vs.85%29.aspx">Sleep</a> function. This is what MSDN says about Sleep function.</p>

<blockquote><p>This function causes a thread to relinquish the remainder of its time slice and become unrunnable for an interval based on the value of dwMilliseconds. The system clock &ldquo;ticks&rdquo; at a constant rate. If dwMilliseconds is less than the resolution of the system clock, the thread may sleep for less than the specified length of time. If dwMilliseconds is greater than one tick but less than two, the wait can be anywhere between one and two ticks, and so on.</p></blockquote>

<p>It is clear that <code>Sleep()</code> won&rsquo;t sleep exactly for the interval specified. This can be problematic if your application needs to be accurate with the intervals. This is also dependent on how much load CPU has. If CPU is really overloaded, this time could be longer. This also makes it hard to tell when the job will run next time. If you have done some action which needs to be processed by the background job and not knowing when background job will kick in next time is bad.</p>

<p>If your thread is running with a low priority, sleep duration could be more than the specified interval.</p>

<p>If you are trying to implement something which runs periodically, use <code>System.Threading.Timer</code> class which provides better scheduling capabilities. It runs the callback at specified intervals on a thread pool thread.</p>

<p>Is <code>Thread.Sleep()</code> really evil? NO, if you understand all the above problems and you are OK with the above behaviour. Yes otherwise.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/17/working-with-native-code-in-csharp-easily-with-cplusplus-cli/">
		
			Working With Native Code Easily in C# With the Help of C++/CLI</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-02-17T12:18:00+05:30" pubdate data-updated="true">Feb 17<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/c-number/'>c#,</a>, <a class='category' href='/blog/categories/c-plus-plus-slash-cli/'>c++/cli</a>


</div>
    </div>
		<p>.NET comes with pretty good interoperability options which would enable unmanaged code to be used from a managed environment. In C#, to call a function which is available in a DLL, <code>PInvoke</code> (Platform invocation service) can be used. Here is what MSDN says.</p>

<blockquote><p>Platform Invocation Services (PInvoke) allows managed code to call unmanaged functions that are implemented in a DLL.</p></blockquote>

<p>This is very helpful when you need to call some system functions from your C# application. Now let us assume that you have lot of code which is written in C or C++. You are writing a brand new application in C# which internally uses the C/C++ code available. Since C/C++ code is categorised as unmanaged code, you can&rsquo;t directly use them in C#. At C# side, wrapper classes and functions has to be written to interop properly with the native code. As I said earlier, if you just need to use a single function, it is easy to do directly from C# using <code>PInvoke</code>. But when you need almost all the functionalities/API to be available as a managed object, <code>PInvoke</code> would be a pain to use. Let us take an example from <a href="http://msdn.microsoft.com/en-us/library/aa288468%28v=vs.71%29.aspx">MSDN</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">typedef</span> <span class="k">struct</span> <span class="n">tagLOGFONT</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">LONG</span> <span class="n">lfHeight</span><span class="p">;</span>
</span><span class='line'>   <span class="n">LONG</span> <span class="n">lfWidth</span><span class="p">;</span>
</span><span class='line'>   <span class="n">LONG</span> <span class="n">lfEscapement</span><span class="p">;</span>
</span><span class='line'>   <span class="n">LONG</span> <span class="n">lfOrientation</span><span class="p">;</span>
</span><span class='line'>   <span class="n">LONG</span> <span class="n">lfWeight</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfItalic</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfUnderline</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfStrikeOut</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfCharSet</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfOutPrecision</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfClipPrecision</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfQuality</span><span class="p">;</span>
</span><span class='line'>   <span class="n">BYTE</span> <span class="n">lfPitchAndFamily</span><span class="p">;</span>
</span><span class='line'>   <span class="n">TCHAR</span> <span class="n">lfFaceName</span><span class="p">[</span><span class="n">LF_FACESIZE</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span> <span class="n">LOGFONT</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In C#, this can be represented as</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">// logfont.cs</span>
</span><span class='line'><span class="c1">// compile with: /target:module</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">[StructLayout(LayoutKind.Sequential)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">LOGFONT</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">LF_FACESIZE</span> <span class="p">=</span> <span class="m">32</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">lfHeight</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">lfWidth</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">lfEscapement</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">lfOrientation</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">int</span> <span class="n">lfWeight</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfItalic</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfUnderline</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfStrikeOut</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfCharSet</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfOutPrecision</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfClipPrecision</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfQuality</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">byte</span> <span class="n">lfPitchAndFamily</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">    [MarshalAs(UnmanagedType.ByValTStr, SizeConst=LF_FACESIZE)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">lfFaceName</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Look at the C# example. It is not as clean as the structure definition at the C side. It contains attributes which specify the structure alignment, then marshaling etc. When the structure contains references to other structures, things gets complicated.</p>

<p>For C or C++ programmers, it is always convenient to declare the struct as they normally do. That&rsquo;s the beauty of <code>C++/CLI</code> which allows you to combine managed and unmanaged code together and makes interoperability very straightforward.</p>

<p>In this post, we will take <code>SQLite</code> as an example and write a managed class which can be consumed from C#. We will wrap SQLite code using <code>C++/CLI</code> and consume from C#. SQLite has a huge API and we won&rsquo;t be covering all of them. We will cover APIs which will allow to open a DB connection and execute a simple query.</p>

<p>Note: SQLite is chosen as an example. The correct way to wrap SQLite is adhering to ADO.NET standards and providing a API by extending IDBConnection. But for this post, we will ignore this and provide a custom simple API.</p>

<h2>SQLite API</h2>

<p>We will wrap the following functions</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">sqlite3_open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span> <span class="n">sqlite3</span> <span class="o">**</span><span class="n">ppDb</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">sqlite3_exec</span><span class="p">(</span>
</span><span class='line'>  <span class="n">sqlite3</span><span class="o">*</span><span class="p">,</span>                                  <span class="cm">/* An open database */</span>
</span><span class='line'>  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sql</span><span class="p">,</span>                           <span class="cm">/* SQL to be evaluated */</span>
</span><span class='line'>  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span><span class="kt">int</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span><span class="p">),</span>  <span class="cm">/* Callback function */</span>
</span><span class='line'>  <span class="kt">void</span> <span class="o">*</span><span class="p">,</span>                                    <span class="cm">/* 1st argument to callback */</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">**</span><span class="n">errmsg</span>                              <span class="cm">/* Error msg written here */</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our managed API will look like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">SQLite</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SQLite</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
</span><span class='line'><span class="n">db</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>callback</code> can be assigned to a function which takes 2 parameters of type <code>List&lt;String&gt;</code>. It will contain column names and values respectively.</p>

<h2>Wrapper class in C++/CLI</h2>

<p>We will have a Visual studio solution with 3 projects.</p>

<ul>
<li>Static library which contains SQLite source code. This will be compiled as C and produces a static library.</li>
<li>C++/CLI library project which adds the first project as a reference.</li>
<li>A C# console application for testing. This project will have a reference to the assembly generated by C++/CLI project.</li>
</ul>


<p><img src="/images/posts/20130217/solution_explorer.png" alt="Solution explorer" /></p>

<p>In C++/CLI, we start off by creating the following class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// SQLiteWrapper.h</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma once</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;sqlite3.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">System</span><span class="o">::</span><span class="n">Collections</span><span class="o">::</span><span class="n">Generic</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">SQLiteWrapper</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Main class that wraps the native API</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">SQLite</span> <span class="o">:</span> <span class="n">IDisposable</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span><span class="o">:</span>
</span><span class='line'>        <span class="n">SQLite</span><span class="p">(</span><span class="n">String</span><span class="o">^</span> <span class="n">filePath</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">void</span> <span class="n">Execute</span><span class="p">(</span><span class="n">String</span><span class="o">^</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Action</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^&gt;^</span> <span class="n">callback</span><span class="p">);</span>
</span><span class='line'>        <span class="o">~</span><span class="n">SQLite</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span><span class="o">:</span>
</span><span class='line'>        <span class="n">sqlite3</span><span class="o">*</span> <span class="n">db</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">SQLiteError</span> <span class="o">:</span> <span class="n">Exception</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span><span class="o">:</span>
</span><span class='line'>        <span class="n">SQLiteError</span><span class="p">(</span><span class="n">String</span><span class="o">^</span> <span class="n">errorMessage</span><span class="p">);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="n">ref</span> <span class="k">class</span> <span class="nc">SQLiteDataCarrier</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>    <span class="k">public</span><span class="o">:</span>
</span><span class='line'>        <span class="n">SQLiteDataCarrier</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnNames</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnValues</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="o">-&gt;</span><span class="n">columnNames</span> <span class="o">=</span> <span class="n">columnNames</span><span class="p">;</span>
</span><span class='line'>            <span class="k">this</span><span class="o">-&gt;</span><span class="n">columnValues</span> <span class="o">=</span> <span class="n">columnValues</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">property</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">ColumnNames</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">get</span><span class="p">()</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">columnNames</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">property</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">ColumnValues</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">get</span><span class="p">()</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">columnValues</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span><span class="o">:</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnNames</span><span class="p">;</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnValues</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This class holds an instance to <code>sqlite3</code> structure which is the core of SQLite library. Even though the class is a managed class, C++/CLI allows you to hold a pointer which points to <code>sqlite3</code>.</p>

<p>Our constructor can be implemented like,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// Constructor for managed class SQLite</span>
</span><span class='line'><span class="n">SQLite</span><span class="o">::</span><span class="n">SQLite</span><span class="p">(</span><span class="n">String</span><span class="o">^</span> <span class="n">filePath</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">IntPtr</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Marshal</span><span class="o">::</span><span class="n">StringToHGlobalAnsi</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">_filePath</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">ToPointer</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">sqlite3</span><span class="o">*</span> <span class="n">d</span><span class="p">;</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">sqlite3_open</span><span class="p">(</span><span class="n">_filePath</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
</span><span class='line'>            <span class="k">throw</span> <span class="n">gcnew</span> <span class="n">SQLiteError</span><span class="p">(</span><span class="s">&quot;Unable to open database&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Holding the DB pointer as a field</span>
</span><span class='line'>        <span class="c1">// This is a pointer to native struct, but it can be stored in managed class!</span>
</span><span class='line'>        <span class="n">db</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">finally</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Marshal</span><span class="o">::</span><span class="n">FreeHGlobal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code shows how well C++/CLI allows you to mix types from both managed and unmanaged world. It is beautiful!</p>

<p>All this constructor does is to initialize <code>sqlite3</code> instance and update the <code>db</code> pointer with correct reference.</p>

<p>Here is how <code>Execute()</code> method is implemented.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// Callback function called by SQLite.</span>
</span><span class='line'><span class="c1">// This function shows how native and managed objects can work together!</span>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">azColName</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">IntPtr</span> <span class="n">pointer</span><span class="p">(</span><span class="n">userData</span><span class="p">);</span>
</span><span class='line'>    <span class="n">GCHandle</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">GCHandle</span><span class="o">::</span><span class="n">FromIntPtr</span><span class="p">(</span><span class="n">pointer</span><span class="p">);</span>
</span><span class='line'>    <span class="n">SQLiteDataCarrier</span><span class="o">^</span> <span class="n">carrier</span> <span class="o">=</span> <span class="p">(</span><span class="n">SQLiteDataCarrier</span><span class="o">^</span><span class="p">)</span> <span class="n">handle</span><span class="p">.</span><span class="n">Target</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">columnName</span> <span class="o">=</span> <span class="n">azColName</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>        <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">columnValue</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">carrier</span><span class="o">-&gt;</span><span class="n">ColumnNames</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">gcnew</span> <span class="n">String</span><span class="p">(</span><span class="n">columnName</span><span class="p">));</span>
</span><span class='line'>        <span class="n">carrier</span><span class="o">-&gt;</span><span class="n">ColumnValues</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">gcnew</span> <span class="n">String</span><span class="p">(</span><span class="n">columnValue</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">SQLite</span><span class="o">::</span><span class="n">Execute</span><span class="p">(</span><span class="n">String</span><span class="o">^</span> <span class="n">sql</span><span class="p">,</span> <span class="n">Action</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^&gt;^</span> <span class="n">callback</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">IntPtr</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Marshal</span><span class="o">::</span><span class="n">StringToHGlobalAnsi</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">_sql</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">ToPointer</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Output will be stored in these lists</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnNames</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;</span><span class="p">();</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;^</span> <span class="n">columnValues</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">^&gt;</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// A simple class to aggregate columnNames and columnValues so that it can be passed to SQLite and SQLite will give it back in the callback function</span>
</span><span class='line'>    <span class="n">SQLiteDataCarrier</span><span class="o">^</span> <span class="n">carrier</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">SQLiteDataCarrier</span><span class="p">(</span><span class="n">columnNames</span><span class="p">,</span> <span class="n">columnValues</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Converting carrier to void*</span>
</span><span class='line'>    <span class="n">GCHandle</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">GCHandle</span><span class="o">::</span><span class="n">Alloc</span><span class="p">(</span><span class="n">carrier</span><span class="p">);</span>
</span><span class='line'>    <span class="n">IntPtr</span> <span class="n">pointer</span> <span class="o">=</span> <span class="n">GCHandle</span><span class="o">::</span><span class="n">ToIntPtr</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">char</span> <span class="o">*</span><span class="n">zErrMsg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">sqlite3_exec</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">_sql</span><span class="p">,</span> <span class="n">_callback</span><span class="p">,</span> <span class="n">pointer</span><span class="p">.</span><span class="n">ToPointer</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">zErrMsg</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="n">SQLITE_OK</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">String</span><span class="o">^</span> <span class="n">message</span> <span class="o">=</span> <span class="n">gcnew</span> <span class="n">String</span><span class="p">(</span><span class="n">sqlite3_errmsg</span><span class="p">(</span><span class="n">db</span><span class="p">));</span>
</span><span class='line'>        <span class="k">throw</span> <span class="n">gcnew</span> <span class="n">SQLiteError</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">callback</span><span class="o">-&gt;</span><span class="n">Invoke</span><span class="p">(</span><span class="n">columnNames</span><span class="p">,</span> <span class="n">columnValues</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">handle</span><span class="p">.</span><span class="n">Free</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Marshal</span><span class="o">::</span><span class="n">FreeHGlobal</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To add results into the list, we are passing both lists to the <code>sqlite3_exec()</code> function so that SQLite will pass that back to the <code>_callback</code> function. This is very powerful because we just passed a managed object into a native function call. Then in a native function, we obtained the managed instance and modified properties on it.</p>

<p>Once the querying is done, database has to be closed. We do that in the destructor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// In C++/CLI destructor will be implemented using Dispose() pattern</span>
</span><span class='line'><span class="n">SQLite</span><span class="o">::~</span><span class="n">SQLite</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">sqlite3_close</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using from C#</h2>

<p>Usage from C# now becomes pretty straightforward.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">ConsoleApplication1</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Program</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">SQLite</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SQLite</span><span class="p">(</span><span class="s">&quot;C:\\Users\\navaneeth\\Desktop\\test\\example.db&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="kt">string</span> <span class="n">sql</span> <span class="p">=</span> <span class="s">&quot;create table if not exists foos (name text);\n&quot;</span> <span class="p">+</span>
</span><span class='line'>                <span class="s">&quot;insert into foos values (&#39;sample1&#39;);&quot;</span> <span class="p">+</span>
</span><span class='line'>                <span class="s">&quot;insert into foos values (&#39;sample2&#39;);&quot;</span> <span class="p">+</span>
</span><span class='line'>                <span class="s">&quot;select * from foos;&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="n">db</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">columnNames</span><span class="p">,</span> <span class="n">columnValues</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">name</span> <span class="k">in</span> <span class="n">columnNames</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="k">value</span> <span class="k">in</span> <span class="n">columnValues</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="n">db</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</span><span class='line'>            <span class="n">Console</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can download the code <a href="https://dl.dropbox.com/u/52296034/blog/SQLiteWrapper.zip">here</a>. Happy programming!</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/02/08/funny-gtk-warning/">
		
			Funny GTK Warning</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2013-02-08T00:23:00+05:30" pubdate data-updated="true">Feb 8<span>th</span>, 2013</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/gtk/'>gtk,</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/warnings/'>warnings,</a>


</div>
    </div>
		<p>I was working with a GTK application and got the below warning.</p>

<blockquote><p> Trying to remove a child that doesn&rsquo;t believe we&rsquo;re it&rsquo;s parent</p></blockquote>

<p>:)</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/05/11/simple-generic-and-dynamically-allocated-array-in-c/">
		
			Simple, Generic and Dynamically Allocated Array in C</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-05-11T23:31:00+05:30" pubdate data-updated="true">May 11<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/c/'>c,</a>, <a class='category' href='/blog/categories/datastructures/'>datastructures</a>


</div>
    </div>
		<p>C is a very good language. I have been using for quite some time for my opensource project. The flexibility C offers is really good. But sometimes, lack of simple datastructures like a dynamically growing array will slow down the programmer. There are tons of implementation available online, but most of them are overcomplicated, got lot of dependencies or tough to understand and incorporate with your application. In this post, I present a simple array which grows dynamically, reuses the memory, supports any pointer type and easy to copy to your code base.</p>

<p>Here is the code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">typedef</span> <span class="k">struct</span> <span class="n">varray_t</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="kt">void</span> <span class="o">**</span><span class="n">memory</span><span class="p">;</span>
</span><span class='line'>   <span class="kt">size_t</span> <span class="n">allocated</span><span class="p">;</span>
</span><span class='line'>   <span class="kt">size_t</span> <span class="n">used</span><span class="p">;</span>
</span><span class='line'>   <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="n">varray</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">varray_init</span><span class="p">(</span><span class="n">varray</span> <span class="o">**</span><span class="n">array</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="n">varray</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">varray</span><span class="p">));</span>
</span><span class='line'>   <span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">memory</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>   <span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">allocated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">varray_push</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="kt">size_t</span> <span class="n">toallocate</span><span class="p">;</span>
</span><span class='line'>   <span class="kt">size_t</span> <span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">);</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">((</span><span class="n">array</span><span class="o">-&gt;</span><span class="n">allocated</span> <span class="o">-</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">used</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">toallocate</span> <span class="o">=</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">allocated</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">size</span> <span class="o">:</span> <span class="p">(</span><span class="n">array</span><span class="o">-&gt;</span><span class="n">allocated</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>      <span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span> <span class="o">=</span> <span class="n">realloc</span><span class="p">(</span><span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">,</span> <span class="n">toallocate</span><span class="p">);</span>
</span><span class='line'>      <span class="n">array</span><span class="o">-&gt;</span><span class="n">allocated</span> <span class="o">=</span> <span class="n">toallocate</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">[</span><span class="o">++</span><span class="n">array</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
</span><span class='line'>   <span class="n">array</span><span class="o">-&gt;</span><span class="n">used</span> <span class="o">=</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">used</span> <span class="o">+</span> <span class="n">size</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">varray_length</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">varray_clear</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>   <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">varray_length</span><span class="p">(</span><span class="n">array</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="n">array</span><span class="o">-&gt;</span><span class="n">used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>   <span class="n">array</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">varray_free</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">free</span><span class="p">(</span><span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">);</span>
</span><span class='line'>   <span class="n">free</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span><span class="o">*</span>
</span><span class='line'><span class="nf">varray_get</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">return</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span>
</span><span class='line'><span class="nf">varray_insert</span><span class="p">(</span><span class="n">varray</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">array</span><span class="o">-&gt;</span><span class="n">memory</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This array doesn’t take ownership of the data it contains. Ownership has to be managed separately. When adding a new item, array grows in constant propotion yielding inserts in amortized constant time. I have omitted error checking for malloc and realloc for simplicity.</p>

<p>Hope you enjoy the post.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/12/19/simple-egg-timer-on-linux-for-pomodoro-technique/">
		
			Simple Egg Timer on Linux for Pomodoro Technique</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2010-12-19T21:19:00+05:30" pubdate data-updated="true">Dec 19<span>th</span>, 2010</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/linux/'>linux,</a>, <a class='category' href='/blog/categories/pomodoro/'>pomodoro,</a>, <a class='category' href='/blog/categories/productivity/'>productivity,</a>, <a class='category' href='/blog/categories/shell/'>shell</a>


</div>
    </div>
		<p>Recently I have started evaluating the Pomodoro Technique which I found quite interesting. I am still evaluating the technique and not yet concluded on whether I should continue using it.</p>

<p>To implement pomodoro technique, you need a kitchen timer or egg timer. Since I use pomodoro for my programming work, I obviously don’t want to use a physical timer. I couldn’t find a decent timer for linux especially one that works well with Xfce. In this blog post, I will explain building a kitchen timer with basic linux programming techniques. This also gives an idea about how simple linux tools can be combined to do useful stuff.</p>

<p>Things that are used</p>

<ul>
<li>Shell scripting</li>
<li>Notification mechanisms on popular desktops like Gnome and Xfce. (I use Xfce in this example)</li>
</ul>


<p>The shell script is actually a modified version of the one published here (<a href="http://mostlylinux.wordpress.com/commandline/eggtimer/">http://mostlylinux.wordpress.com/commandline/eggtimer/</a>).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">counter</span><span class="o">=</span>0
</span><span class='line'><span class="nv">limit</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'><span class="nv">summary</span><span class="o">=</span><span class="nv">$2</span>
</span><span class='line'><span class="nv">startmessage</span><span class="o">=</span><span class="nv">$3</span>
</span><span class='line'><span class="nv">endmessage</span><span class="o">=</span><span class="nv">$4</span>
</span><span class='line'>notify-send -u critical -i appointment -t 600 <span class="s2">&quot;$summary&quot;</span> <span class="s2">&quot;$startmessage&quot;</span>
</span><span class='line'><span class="nb">echo</span>
</span><span class='line'><span class="k">while</span> <span class="o">[</span> <span class="nv">$counter</span> !<span class="o">=</span> <span class="nv">$limit</span> <span class="o">]</span>; <span class="k">do</span>
</span><span class='line'><span class="k">   </span><span class="nb">echo</span> <span class="s2">&quot;$counter minutes so far...&quot;</span>;
</span><span class='line'>   sleep 60
</span><span class='line'>   <span class="nb">let</span> <span class="s2">&quot;counter = $counter + 1&quot;</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="nv">$counter</span> <span class="o">=</span> <span class="nv">$limit</span> <span class="o">]</span>; <span class="k">then</span>
</span><span class='line'><span class="k">   </span><span class="nb">echo</span>
</span><span class='line'><span class="nb">   </span>notify-send -u critical -i appointment <span class="s2">&quot;$summary&quot;</span> <span class="s2">&quot;$endmessage&quot;</span>
</span><span class='line'>   <span class="nb">echo</span> -e <span class="s1">&#39;\a&#39;</span> &amp;gt;&amp;amp;2
</span><span class='line'>   <span class="nb">exit </span>0
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>All it does is wait until the limit reaches. It uses the sleep(1) command to sleep for a minute. notify-send is used for sending notifications to the desktop environment.</p>

<p>This script can be invoked using,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./p-timer.sh
</span></code></pre></td></tr></table></div></figure>


<p>If you use bash, you can add an alias for convenience.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">alias </span>begin-pomodoro<span class="o">=</span><span class="s1">&#39;sh ~/utils/p-timer.sh 25 &quot;Pomodoro&quot; &quot;Pomodoro started, you have 25 minutes left&quot; &quot;Pomodoro ended. Please stop the work and take short break&quot;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This post is written on one pomodoro!</p>

<p>Happy programming!</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/09/15/disabling-a-custom-control-from-visual-studios-toolbox/">
		
			Disabling a Custom Control From Visual Studio’s Toolbox</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2009-09-15T23:52:00+05:30" pubdate data-updated="true">Sep 15<span>th</span>, 2009</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/visual/'>&#8220;visual</a>, <a class='category' href='/blog/categories/dot-net/'>.net,</a>, <a class='category' href='/blog/categories/c-number/'>c#,</a>, <a class='category' href='/blog/categories/studio/'>studio&#8221;</a>


</div>
    </div>
		<p>When a custom control is created, Visual Studio will show it in the toolbox for dragging and dropping. This can be annoying when you create a composite control which is a combination of several other custom controls where VS will display all custom controls in the toolbox. <code>System.ComponentModel.ToolBoxItemAttribute</code> can be used with the controls that you want to hide from toolbox. Apply this attribute to all the controls that you want to hide from toolbox.</p>

<p>Sample code</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[System.ComponentModel.ToolboxItem(false)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">MyCustomControl</span> <span class="p">:</span> <span class="n">Label</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>MyCustomControl</code> will not be displayed on the toolbox.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2013

    nkn
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'lovetocode';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
